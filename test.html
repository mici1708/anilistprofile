<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Test Panel</title>
</head>
<body>
  <button id="login">Login con AniList</button>
  <div id="result"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const result = document.getElementById('result');
      const loginBtn = document.getElementById('login');

      const backendURL = "https://anilistprofile.onrender.com";
      const token = new URLSearchParams(window.location.search).get("token");

      if (token) {
        result.textContent = "Login fatto! Caricamento lista...";
        setTimeout(() => {
          fetch(`${backendURL}/list`, {
            headers: { Authorization: token }
          })
          .then(res => res.json())
          .then(data => {
            const user = data.data.Viewer;
            result.innerHTML = `<h2>Lista di ${user.name}</h2>`;
            user.animeList.lists.forEach(list => {
              result.innerHTML += `<h3>${list.name}</h3>`;
              list.entries.forEach(entry => {
                const anime = entry.media;
                result.innerHTML += `
                  <div>
                    <img src="${anime.coverImage.medium}" alt="cover">
                    ${anime.title.english || anime.title.romaji}
                  </div>
                `;
              });
            });
          })
          .catch(() => {
            result.textContent = "Errore nel recuperare la lista.";
          });
        }, 2000);
      } else {
        loginBtn.addEventListener('click', () => {
          window.location.href = `${backendURL}/auth/login`;
        });
      }
    });
  </script>
</body>
</html>
